<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Auction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden; /* Prevent overflow during animation */
        }
        
        .nav-button {
            flex-shrink: 0;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 9999px; /* circle */
            background: rgba(45, 55, 72, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .nav-button:hover {
            background: rgba(60, 70, 90, 0.7);
            transform: scale(1.05);
        }

        .nav-button:active {
            transform: scale(0.95);
        }
        
        #loading-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffffff;
            font-size: 1.25rem;
            font-weight: 600;
        }
        .glass-card {
            background: rgba(45, 55, 72, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* Animation Keyframes */
        @keyframes slideInNext {
            from {
                transform: translateX(100%) scale(0.9);
                opacity: 0;
            }
            to {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }
        @keyframes slideInPrev {
            from {
                transform: translateX(-100%) scale(0.9);
                opacity: 0;
            }
            to {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }
        
        .animate-next {
            animation: slideInNext 0.5s ease-out forwards;
        }

        .animate-prev {
            animation: slideInPrev 0.5s ease-out forwards;
        }

        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(25px); /* Increased blur */
            transform: scale(1.1);
            z-index: -1;
            transition: background-image 0.5s ease-in-out;
        }

        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(26, 32, 44, 0.7);
            z-index: -1;
        }

        .party-pop {
            animation: pop 0.5s ease-out forwards;
        }

        @keyframes pop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #ffeb3b;
            animation: confetti-fall 2s ease-out forwards;
            opacity: 0;
            z-index: 10;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(0) rotateZ(0deg) scale(0); opacity: 1; }
            100% { transform: translateY(-500px) rotateZ(720deg) scale(1); opacity: 0; }
        }

        .balloon {
            position: absolute;
            width: 30px;
            height: 40px;
            border-radius: 50%;
            opacity: 0;
            animation: balloon-float 3s ease-out forwards;
            z-index: 10;
        }

        @keyframes balloon-float {
            0% { transform: translateY(0) scale(0); opacity: 1; }
            100% { transform: translateY(-700px) scale(1); opacity: 0; }
        }
        
        .ribbon {
            position: absolute;
            width: 2px;
            height: 20px;
            background-color: white;
            animation: ribbon-fall 2s ease-out forwards;
            opacity: 0;
            z-index: 10;
        }
        
        @keyframes ribbon-fall {
            0% { transform: translateY(0) rotate(0deg) scale(0); opacity: 1; }
            100% { transform: translateY(-500px) rotate(360deg) scale(1); opacity: 0; }
        }

    </style>
</head>
<body>
    <div id="background-image-container" class="background-image"></div>
    <div id="background-overlay" class="background-overlay"></div>
    <div id="party-container" class="fixed inset-0 z-20 pointer-events-none"></div>

    <div id="loading-message">Loading players...</div>

    <!-- Main container for the card and navigation buttons -->
    <div id="card-container" class="w-full max-w-3xl flex items-center justify-center space-x-2 sm:space-x-4 px-2 sm:px-4 hidden">

        <!-- Previous Button -->
        <button id="prev-button" class="nav-button" aria-label="Previous player">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
        </button>

        <!-- Player Card -->
        <div id="auction-slide" class="glass-card rounded-2xl p-8 max-w-md w-full flex flex-col items-center text-center" style="height: 90vh;">
            <!-- Player Photo Section -->
            <div class="w-48 h-48 rounded-full bg-gray-700 flex items-center justify-center overflow-hidden border-4 border-yellow-400 mb-6 shadow-lg transition-transform duration-500 ease-in-out hover:scale-1.05">
                <img id="player-photo" src="https://placehold.co/192x192/2d3748/ffffff?text=Player" alt="Player Photo" class="w-full h-full object-cover">
            </div>

            <!-- Player Details Section -->
            <div class="w-full">
                <h1 id="player-name" class="text-4xl font-extrabold text-white mb-2 tracking-wide">Player Name</h1>
                <h2 id="player-position" class="text-xl text-yellow-400 font-semibold mb-2">Position</h2>
                <p id="player-batch" class="text-sm text-gray-400 uppercase tracking-widest font-medium">Batch</p>
                <div id="sold-info" class="text-white text-lg mt-4 font-bold hidden">
                    <span id="sold-status" class="text-green-500 party-pop">SOLD</span>
                </div>
                <p id="unsold-status" class="text-red-500 text-lg mt-4 font-bold hidden">UNSOLD</p>
            </div>
            
            <!-- Action Buttons and Input -->
            <div class="mt-8 flex flex-col items-center w-full">
                <div class="flex items-center space-x-2 mb-4">
                    <label for="sell-price" class="text-white font-medium">Sell Price:</label>
                    <input type="number" id="sell-price" class="w-24 p-2 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="0" min="0">
                </div>
                <button id="sell-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-1.05 focus:outline-none">
                    Mark as Sold
                </button>
            </div>
        </div>

        <!-- Next Button -->
        <button id="next-button" class="nav-button" aria-label="Next player">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
        </button>
    </div>

    <!-- Custom Modal/Message Box -->
    <div id="custom-alert" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full">
            <p id="alert-message" class="text-white text-center mb-4"></p>
            <button id="alert-close-btn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg">
                OK
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let players = [];
            let currentPlayerIndex = 0;
            let isAnimating = false;

            const backgroundImageContainer = document.getElementById('background-image-container');
            const soldInfo = document.getElementById('sold-info');
            const unsoldStatus = document.getElementById('unsold-status');
            const sellPriceInput = document.getElementById('sell-price');
            const sellButton = document.getElementById('sell-button');
            const slide = document.getElementById('auction-slide');
            const customAlert = document.getElementById('custom-alert');
            const alertMessage = document.getElementById('alert-message');
            const alertCloseBtn = document.getElementById('alert-close-btn');
            const prevButton = document.getElementById('prev-button');
            const nextButton = document.getElementById('next-button');
            const partyContainer = document.getElementById('party-container');
            const cardContainer = document.getElementById('card-container');

            function showAlert(message) {
                alertMessage.textContent = message;
                customAlert.classList.remove('hidden');
            }

            function partyAnimation() {
                const colors = ['#ff4b4b', '#f783ac', '#ffeb3b', '#64ffda', '#2196f3'];
                const cardRect = slide.getBoundingClientRect();
                const getRandom = (min, max) => Math.random() * (max - min) + min;

                const fragment = document.createDocumentFragment();

                // Create and append confetti to fragment
                for (let i = 0; i < 200; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    const x = getRandom(-cardRect.width / 2, cardRect.width / 2);
                    const y = getRandom(-cardRect.height / 2, cardRect.height / 2);
                    const rotation = getRandom(0, 360);
                    
                    confetti.style.left = `${cardRect.left + cardRect.width / 2 + x}px`;
                    confetti.style.top = `${cardRect.top + cardRect.height / 2 + y}px`;
                    
                    fragment.appendChild(confetti);

                    setTimeout(() => {
                        confetti.style.transform = `translateY(${getRandom(-100, -500)}px) translateX(${getRandom(-200, 200)}px) rotate(${rotation}deg)`;
                        confetti.style.opacity = 0;
                    }, 10);
                }

                // Create and append ribbons to fragment
                for (let i = 0; i < 50; i++) {
                    const ribbon = document.createElement('div');
                    ribbon.className = 'ribbon';
                    ribbon.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    const x = getRandom(-cardRect.width / 2, cardRect.width / 2);
                    const y = getRandom(-cardRect.height / 2, cardRect.height / 2);
                    const rotation = getRandom(0, 360);

                    ribbon.style.left = `${cardRect.left + cardRect.width / 2 + x}px`;
                    ribbon.style.top = `${cardRect.top + cardRect.height / 2 + y}px`;
                    
                    fragment.appendChild(ribbon);

                    setTimeout(() => {
                        ribbon.style.transform = `translateY(${getRandom(-100, -600)}px) translateX(${getRandom(-250, 250)}px) rotate(${rotation}deg)`;
                        ribbon.style.opacity = 0;
                    }, 10);
                }

                partyContainer.appendChild(fragment);

                setTimeout(() => {
                    partyContainer.innerHTML = '';
                }, 2000);
            }

            function preloadImages() {
                players.forEach(player => {
                    if (player.photo) {
                       const img = new Image();
                       img.src = player.photo;
                    }
                });
            }
            
            function updateSlide(player, direction) {
                if (!player) return;

                if (direction === 'next' || direction === 'prev') {
                    if (isAnimating) return;
                    isAnimating = true;

                    slide.classList.remove('animate-next', 'animate-prev');
                    // This forces a reflow, allowing the animation to restart
                    void slide.offsetWidth; 

                    slide.classList.add(direction === 'next' ? 'animate-next' : 'animate-prev');
                    slide.addEventListener('animationend', () => { isAnimating = false; }, { once: true });
                }
                
                const playerPhoto = document.getElementById('player-photo');
                playerPhoto.src = player.photo || "https://placehold.co/192x192/2d3748/ffffff?text=No+Photo";
                document.getElementById('player-name').textContent = player.name || "Unknown Player";
                document.getElementById('player-position').textContent = player.position || "Unknown Position";
                document.getElementById('player-batch').textContent = player.batch || "Unknown Batch";
                
                backgroundImageContainer.style.backgroundImage = player.photo ? `url('${player.photo}')` : '';

                playerPhoto.onerror = function() {
                    this.src = "https://placehold.co/192x192/2d3748/ffffff?text=Photo+Error";
                    backgroundImageContainer.style.backgroundImage = '';
                };

                if (player.isSold) {
                    soldInfo.classList.remove('hidden');
                    unsoldStatus.classList.add('hidden');
                    sellButton.textContent = "Unsell Player";
                    sellButton.classList.replace('bg-green-500', 'bg-red-500');
                    sellButton.classList.replace('hover:bg-green-600', 'hover:bg-red-600');
                    sellPriceInput.value = player.sellingPrice;
                    sellPriceInput.disabled = true;
                } else {
                    soldInfo.classList.add('hidden');
                    unsoldStatus.classList.remove('hidden');
                    sellButton.textContent = "Mark as Sold";
                    sellButton.classList.replace('bg-red-500', 'bg-green-500');
                    sellButton.classList.replace('hover:bg-red-600', 'hover:bg-green-600');
                    sellPriceInput.value = '';
                    sellPriceInput.disabled = false;
                }
            }

            async function fetchPlayers() {
                const loadingMessage = document.getElementById('loading-message');
                try {
                    loadingMessage.classList.remove('hidden');
                    cardContainer.classList.add('hidden');

                    const response = await fetch('https://raw.githubusercontent.com/sonuk299/EPL/refs/heads/main/EPL%20(Responses)%20-%20Form%20responses%201.csv');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const csvText = await response.text();
                    
                    const lines = csvText.split(/\r?\n/).filter(line => line.trim() !== '');
                    if (lines.length < 2) {
                        loadingMessage.textContent = 'No player data found.';
                        return;
                    }
                    const data = lines.slice(1);

                    players = data.map(line => {
                        const values = line.split(',');
                        return {
                            name: (values[1] || "").trim(),
                            position: (values[5] || "").trim(),
                            batch: (values[3] || "").trim(),
                            photo: (values[4] || "").trim(),
                            isSold: false,
                            sellingPrice: 0
                        };
                    });
                    
                    if (players.length > 0) {
                        preloadImages();
                        loadingMessage.classList.add('hidden');
                        cardContainer.classList.remove('hidden');
                        updateSlide(players[currentPlayerIndex]);
                    } else {
                        loadingMessage.textContent = 'No player data found.';
                    }

                } catch (error) {
                    console.error('Error fetching or parsing CSV:', error);
                    loadingMessage.textContent = 'Failed to load player data.';
                }
            }

            sellButton.addEventListener('click', () => {
                const currentPlayer = players[currentPlayerIndex];
                if (!currentPlayer) return;

                if (currentPlayer.isSold) {
                    currentPlayer.isSold = false;
                    currentPlayer.sellingPrice = 0;
                } else {
                    const price = parseInt(sellPriceInput.value, 10);
                    if (isNaN(price) || price <= 0) {
                        showAlert('Please enter a valid selling price.');
                        return;
                    }
                    currentPlayer.isSold = true;
                    currentPlayer.sellingPrice = price;
                    partyAnimation();
                }
                updateSlide(currentPlayer);
            });

            alertCloseBtn.addEventListener('click', () => {
                customAlert.classList.add('hidden');
            });

            prevButton.addEventListener('click', () => {
                if (players.length === 0 || isAnimating) return;
                currentPlayerIndex = (currentPlayerIndex - 1 + players.length) % players.length;
                updateSlide(players[currentPlayerIndex], 'prev');
            });

            nextButton.addEventListener('click', () => {
                if (players.length === 0 || isAnimating) return;
                currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
                updateSlide(players[currentPlayerIndex], 'next');
            });

            fetchPlayers();
        });
    </script>
</body>
</html>

